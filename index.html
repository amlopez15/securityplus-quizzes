<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Security+ Quiz Hub</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#0f172a" />
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#a3a3a3; --accent:#38bdf8; --accent2:#0ea5e9; }
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    header{padding:28px 16px;text-align:center}
    h1{margin:0 0 6px;color:var(--accent)} p{margin:0;color:var(--muted)}
    .grid{max-width:980px;margin:18px auto;padding:0 16px;display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:16px}
    .card h3{margin:0 0 6px}
    .meta{font-size:14px;color:#cbd5e1;margin-bottom:10px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    a.btn{display:inline-block;background:var(--accent);color:#0b1220;padding:8px 12px;border-radius:10px;text-decoration:none;font-weight:600}
    a.btn:hover{background:var(--accent2)}
    footer{max-width:980px;margin:30px auto 60px;padding:0 16px;color:#cbd5e1}
    .install{position:fixed;right:14px;bottom:14px}
    button.install-btn{background:transparent;color:var(--accent);border:1px solid var(--accent);padding:8px 12px;border-radius:10px;cursor:pointer}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <header>
    <h1>Security+ Practice Quizzes</h1>
    <p>Pick a quiz below. Works offline once loaded.</p>
  </header>

  <main class="grid" id="quizList" aria-live="polite"></main>

  <footer>
    <p>Tip: Use <code>?mode=exam</code> or <code>?mode=practice</code> in the URL to control behavior. Add <code>&seed=1234</code> to lock shuffle order.</p>
  </footer>

  <div class="install">
    <button id="installBtn" class="install-btn" hidden>Install App</button>
  </div>

  <script>
    // Service worker registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(console.warn);
    }

    // PWA install prompt
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault(); deferredPrompt = e; installBtn.hidden = false;
    });
    installBtn?.addEventListener('click', async () => {
      installBtn.hidden = true;
      if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt = null; }
    });

    // Load quiz manifest and render cards
    fetch('./data/manifest.json').then(r=>r.json()).then(({quizzes})=>{
      const list = document.getElementById('quizList');
      list.innerHTML = '';
      quizzes.forEach(q=>{
        const url = `./quiz.html?id=${encodeURIComponent(q.id)}`;
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <h3>${q.title}</h3>
          <div class="meta">${q.subtitle ?? ''}</div>
          <div class="row">
            <a class="btn" href="${url}&mode=practice">Start (Practice)</a>
            <a class="btn" href="${url}&mode=exam">Start (Exam)</a>
          </div>
        `;
        list.appendChild(card);
      });
    }).catch(err=>{
      document.getElementById('quizList').innerHTML = '<p>Could not load quiz list.</p>';
      console.error(err);
    });
  </script>
</body>
</html>
